<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:rabbit="http://www.springframework.org/schema/rabbit"
  xsi:schemaLocation="http://www.springframework.org/schema/rabbit
  http://www.springframework.org/schema/rabbit/spring-rabbit-1.3.xsd
  http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

  <bean id="aMQPAddressesProvider" class="ptv.feed.sdc.sender.config.AddressProviderImpl">
    <property name="address" value="${rabbit.addresses}" />
  </bean>

  <rabbit:connection-factory id="ocConsumerConnectionFactory"
                             addresses="#{aMQPAddressesProvider.getAddress()}"
                             publisher-confirms="false"
                             publisher-returns="false"
                             channel-cache-size="20"
                             username="${oc-bridge.rabbit.username}"
                             password="#{decrypter.decryptFromBase64String(keyProvider,'${oc-bridge.rabbit.password}')}"
                             virtual-host="${oc-bridge.rabbit.virtual.host}"/>

  <rabbit:admin id="ocRabbitAdmin" connection-factory="ocConsumerConnectionFactory"/>

  <rabbit:template id="ocRabbitTemplate" connection-factory="ocConsumerConnectionFactory" />

  <rabbit:topic-exchange name="${exc.feed.sender}" declared-by="ocRabbitAdmin">
    <rabbit:bindings>
      <rabbit:binding queue="${que.sender.soccer.st1}" pattern="${routing.sender.soccer.st1}" />
    </rabbit:bindings>
  </rabbit:topic-exchange>

  <rabbit:queue name="${que.sender.soccer.st1}" declared-by="ocRabbitAdmin">
    <rabbit:queue-arguments>
      <entry key="x-ha-policy">
        <value type="java.lang.String">all</value>
      </entry>
    </rabbit:queue-arguments>
  </rabbit:queue>

  <rabbit:topic-exchange name="${exc.feed.sender.dead.letter}" declared-by="ocRabbitAdmin">
    <rabbit:bindings>
      <rabbit:binding queue="${que.opta.sender.dead.letter}" pattern="#" />
    </rabbit:bindings>
  </rabbit:topic-exchange>

  <rabbit:queue name="${que.opta.sender.dead.letter}" declared-by="ocRabbitAdmin">
    <rabbit:queue-arguments>
      <entry key="x-message-ttl">
        <value type="java.lang.Long">${que.opta.sender.dead.letter.ttl}</value>
      </entry>
      <entry key="x-dead-letter-exchange" value="${exc.feed.sender}" />
      <entry key="x-ha-policy">
        <value type="java.lang.String">all</value>
      </entry>
    </rabbit:queue-arguments>
  </rabbit:queue>


</beans>
