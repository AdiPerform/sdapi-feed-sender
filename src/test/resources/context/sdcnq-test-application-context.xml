<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans.xsd
		                        http://www.springframework.org/schema/context
		                        http://www.springframework.org/schema/context/spring-context.xsd
                            http://www.springframework.org/schema/integration
                            http://www.springframework.org/schema/integration/spring-integration.xsd
  		                        http://www.springframework.org/schema/rabbit
                            http://www.springframework.org/schema/rabbit/spring-rabbit.xsd">

  <!--Main context-->
  <import resource="sdcnq-context.xml"/>

  <!-- Override properties for tests -->
  <context:property-placeholder location="config/amqp/rabbit.properties" ignore-unresolvable="true" order="0" />  

  <!--below import allows logging spring-integration details in tests, its not used in main config-->
  <import resource="sdcnq-test-tracking-context.xml"/>
  
    <!-- MessageStore definition storing payload using in memory map -->
  <bean id="simpleMessageStore" class="org.springframework.integration.store.SimpleMessageStore" />

  <bean id="rabbitMessageBuilder" class="ptv.feed.sdc.shared.test.rabbit.client.RabbitMessageBuilder" scope="prototype" />

  <!--below configuration allows tracking message while its travel spring-integration flows-->
  <bean id="mqInstrumentationInterceptor" class="ptv.feed.sdc.shared.test.rabbit.dsl.interceptor.MqInstrumentationInterceptor" />
  <bean id="mqControlInterceptor" class="ptv.feed.sdc.shared.test.rabbit.dsl.interceptor.MqControlInterceptor" />

  <int:channel-interceptor pattern="*" order="-1" ref="mqInstrumentationInterceptor"/>

  <int:channel-interceptor pattern="*" order="1" ref="mqControlInterceptor"/>
  
  <bean id="aMQPAddressesProvider" class="ptv.feed.sdc.sender.config.EmbeddedAMQPAddressesProvider" />
  <bean id="httpCloudAddressesProvider" class="ptv.feed.sdc.sender.config.TestHttpCloudAddressesProviderImpl" />

  <rabbit:template id="testSdcnqRabbitTemplate" connection-factory="sdcnqConsumerConnectionFactory" />
  <rabbit:template id="testOcRabbitTemplate" connection-factory="ocConsumerConnectionFactory" />

  <import resource="sdsnq-test-qpid-dead-letter-bridges-context.xml"/>

</beans>
