<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:int-amqp="http://www.springframework.org/schema/integration/amqp"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans.xsd
                            http://www.springframework.org/schema/integration
                            http://www.springframework.org/schema/integration/spring-integration.xsd
                            http://www.springframework.org/schema/integration/amqp
                            http://www.springframework.org/schema/integration/amqp/spring-integration-amqp.xsd">

    <!-- qpid amqp broker does not have dead letter feature implemented same way like rabbitmq has;
         so we use here bridges to simulate how it works in rabbit -->

    <!-- OC -->
    <int:channel id="qpid-oc-dlq-channel"/>
    <int:channel id="qpid-oc-dle-channel" />

    <int-amqp:inbound-channel-adapter queue-names="${que.sdc.oc.dead.letter}"
                                      connection-factory="sdcnqConsumerConnectionFactory" acknowledge-mode="AUTO" channel="qpid-oc-dlq-channel"
                                      mapped-request-headers="*"/>

    <int:bridge input-channel="qpid-oc-dlq-channel" output-channel="qpid-oc-dle-channel" />

    <int-amqp:outbound-channel-adapter amqp-template="testSdcnqRabbitTemplate"
                                       routing-key-expression="headers.amqp_receivedRoutingKey"
                                       exchange-name="${exc.sdc.oc}"
                                       channel="qpid-oc-dle-channel" mapped-request-headers="*" />

</beans>
